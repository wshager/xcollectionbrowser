//>>built
define("xstyle/core/expression",["xstyle/core/utils"],function(s){function l(r,e,b){return s.when(r,function(d){var a=e[0];return!d?b(a||d):a&&d.get?l(d.get(a),e.slice(1),b):d.receive?d.receive(a?function(a){l(a,e,b)}:b):a?l(d[a],e.slice(1),b):b(d)})}function x(r,e,b){l(r,e.slice(0,e.length-1),function(d){var a=e[e.length-1];d.set?d.set(a,b):d[a]=b})}var u={"true":!0,"false":!1,"null":"null","typeof":"typeof",or:"||",and:"\x26\x26"},y=1;return function e(b,d,a){function t(){var a=f.length+1,d=[],
c=[],b,e,k,m=function(f){return function(n){if(!k&&(d[f]=n,a--,0>=a)){e=!0;b=p?p.apply(this,d):d[0];for(n=0;n<c.length;n++)c[n](b)}}},g;if(p)for(var q=0;q<f.length;q++)g=f[q],l(g[0],g.slice(1),m(q));else{g=f[0];var h={then:function(a){c?c.push(a):a(h)}};s.when(g[0],function(a){var b;h=a;for(b=1;b<g.length;b++)if(h&&h.get)h=h.get(g[b]);else{h={receive:function(c){l(a,g.slice(1),c)},put:function(c){x(a,g.slice(1),c)}};break}for(b=0;b<c.length;b++)c[b](h);c=null});return h}m(-1)();return b&&b.then?b:
{receive:function(a){c&&c.push(a);e&&a(b)},stop:function(){k=!0}}}var m=b["var-expr-"+d];if(f)return m;var f=[],v;f.id=y++;var w=[],k;a=a.join?a.join(""):a.toString();m=a.match(/^[\w_$\/\.-]*$/);a=a.replace(/("[^\"]*")|([\w_$\.\/-]+)/g,function(a,d,c){if(c){if(u.hasOwnProperty(c))return u[c];k=c.split("/");a=k.join("_").replace(/-/g,"_");w.push(a);f.push(k);d=k[0];c=b.getDefinition(d);if("string"==typeof c||c instanceof Array)c=e(b,d,c);else if(!c)throw Error('Could not find reference "'+d+'"');c.forElement&&
(v=!0);k[0]=c}return a});if(!m)var p=Function.apply(this,w.concat(["return ("+a+")"]));f.func=p;b["var-expr-"+d]=f;return b["var-expr-"+d]=v?{forElement:function(a){for(var b,c,d=0;d<f.length;d++){c=f[d];var e=c[0];e.forElement&&(e=c[0]=e.forElement(a,1==c.length));e=c=e.element;if(b)for(;c&&c!=b;)c=c.parentNode;c&&(b=e)}a=b["expr-result-"+f.id];a||(b["expr-result-"+f.id]=a=t(),a.element=b);return a}}:t()}});
//# sourceMappingURL=expression.js.map