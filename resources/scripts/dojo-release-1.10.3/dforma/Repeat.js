//>>built
define("dforma/Repeat","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class ./Group dforma/util/i18n dijit/form/Button".split(" "),function(n,g,h,f,p,q,l,m){return n("dforma.Repeat",[q],{baseClass:"dformaRepeat",cols:1,_col:0,_headerNode:null,_rows:null,_controls:null,_addButton:null,label:"",value:null,startup:function(){this.inherited(arguments);p.remove(this.buttonNode,"dijitHidden");this.repeatNode=this.containerNode;this._headerNode=f.create("tr",{},this.repeatNode);
this._rows=[];this._controls=[];var b=this;this.value=[];var a=l.load("dforma","common");if(!this.schema.hasOwnProperty("add")||this.schema.add)this._addButton=(new m({label:a.buttonAdd+(this.label?" "+this.label:""),onClick:function(){b.cloneRow()}})).placeAt(this.buttonNode)},cloneRow:function(){var b=l.load("dforma","common"),a=this._rows.length,e=this;this._rows.push({node:f.create("tr",{},this.repeatNode),controls:[]});h.forEach(this._controls,function(b){b.params.row=a;b=new b.Widget(b.params);
this.addChild(b)},this);var c=f.create("td",{"class":"dformaRepeatCol"},this._rows[a].node);if(!this.schema.hasOwnProperty("delete")||this.schema["delete"])b=(new m({row:a,label:b.buttonRemove,onClick:function(){e.removeRow(this.row)}})).placeAt(c),this._rows[a].controls.push(b)},_getValueAttr:function(){var b=[];h.forEach(this._getDescendantFormWidgets(),function(a){var e=a.name,c=a.row;b[c]||(b[c]={});c=b[c];if(e&&!a.disabled){var d=a.get("value");"boolean"==typeof a.checked?/Radio/.test(a.declaredClass)?
!1!==d?g.setObject(e,d,c):(d=g.getObject(e,!1,c),void 0===d&&g.setObject(e,null,c)):g.setObject(e,"on"===d,c):(a=g.getObject(e,!1,c),"undefined"!=typeof a?g.isArray(a)?a.push(d):g.setObject(e,[a,d],c):g.setObject(e,d,c))}});return b},_setValueAttr:function(b){this._started&&h.forEach(b,function(a,b){(0<b||!this._rows.length)&&this.cloneRow();var c={};h.forEach(this._getDescendantFormWidgets(),function(a){if(a.name){var d=c[a.name]||(c[a.name]=[]);a.row==b&&d.push(a)}});for(var d in c)if(c.hasOwnProperty(d)){var f=
c[d],k=g.getObject(d,!1,a);void 0!==k&&(k=[].concat(k),"boolean"==typeof f[0].checked?h.forEach(f,function(a){a.set("value",-1!=h.indexOf(k,"on"===a._get("value")))}):f[0].multiple?f[0].set("value",k):h.forEach(f,function(a,b){a.set("value",k[b])}))}},this)},removeRow:function(b){this.schema.minItems&&this._rows.length==this.schema.minItems||(h.forEach(this._rows[b].controls,function(a){a.destroyRecursive()}),this.repeatNode.removeChild(this._rows[b].node),this._rows.splice(b,1))},addControl:function(b,
a){f.create("th",{"class":"dformaRepeatHeader"+(a.required?" dformaRequired":""),innerHTML:a.label},this._headerNode);this._controls.push({Widget:b,params:a});this._controls.length==this.options[0].controls.length&&(!this.schema.hasOwnProperty("minItems")||0<this.schema.minItems)&&this.cloneRow()},addChild:function(b,a){var e=this._rows.length-1;this._rows[e].controls.push(b);this.containerNode=f.create("td",{"class":"dformaRepeatCol"},this._rows[e].node);this.inherited(arguments);this.containerNode=
this.repeatNode}})});
//# sourceMappingURL=Repeat.js.map